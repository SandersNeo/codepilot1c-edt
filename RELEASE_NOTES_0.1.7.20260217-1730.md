# CodePilot1C EDT — релиз 0.1.7.20260217-1730

Дата: 17.02.2026

## Коротко

Релиз закрывает 7 из 7 багов MCP-инструментов, найденных на регрессионном прогоне.

## Детализация по багам

### 1) `update_metadata`: ошибка `int -> float` для числовых полей

- До фикса: значение `codeLength: 9` нормализовалось как `9.0`, EDT отклонял изменение (`Invalid value for field codeLength: 9.0`).
- Что изменено: скорректирована конвертация числовых значений в metadata-слое; целочисленные поля приводятся к `Integer/Long` без потери типа.
- После фикса: `codeLength: 9.0` принимается и записывается как `9` в `.mdo`.

### 2) `scan_metadata_index`: пустой или некорректный индекс

- До фикса: `scope=all`/`scope=catalogs` мог возвращать `0` объектов или неполные данные.
- Что изменено: переработан обход конфигурации через BM read-транзакцию, добавлен fallback по известным top-level коллекциям, нормализован dedup.
- После фикса: возвращается полный список объектов конфигурации, `scope`-фильтр работает корректно.

### 3) `bsl_type_at_position`: `EDT_SERVICE_UNAVAILABLE`

- До фикса: при недоступности BM-aware resource set инструмент завершался ошибкой.
- Что изменено: добавлен fallback-механизм загрузки ресурса через standalone resource set.
- После фикса: инструмент возвращает валидный ответ вместо аварийного отказа.

### 4) `bsl_scope_members`: `EDT_SERVICE_UNAVAILABLE`

- До фикса: в аналогичном сценарии инструмент падал и не выдавал кандидатов.
- Что изменено: добавлен fallback на content-assist pipeline при recoverable-ошибках EDT-сервисов.
- После фикса: инструмент стабильно возвращает предложения по области видимости.

### 5) `mutate_form_model add_field`: создавался нефункциональный элемент

- До фикса: `add_field` создавал поле только с минимальными атрибутами (`name/id`), без рабочих свойств.
- Что изменено: расширена обработка `add_field` — применяются `set/properties` и inline-параметры операции (`visible`, `enabled`, `dataPath`, `type`, и т.д.).
- После фикса: создаются полноценные рабочие элементы формы.

### 6) `ensure_module_artifact` для форм

- До фикса: запрос для Form FQN блокировался ошибкой «module artifact is unavailable».
- Что изменено: добавлена поддержка форм в резолвинге кандидатов модуля, включая путь `Forms/<ИмяФормы>/Module.bsl`.
- После фикса: `Module.bsl` для форм создаётся штатно.

### 7) `delete_metadata` для вложенных форм

- До фикса: метаданные формы удалялись из модели, но файловые артефакты (`Forms/<Имя>`) оставались на диске.
- Что изменено: добавлена отдельная очистка файловой структуры для nested Form при удалении.
- После фикса: директория формы и связанные файлы удаляются корректно.

## Результат верификации

- Статус: `7/7` исправлено.
- Регрессий по итогам повторного прогона не обнаружено.

## Артефакты релиза

- Сборка: `mvn -DskipTests package` (полный reactor).
- P2 update site: `repositories/com.codepilot1c.update/target/repository`.
- ZIP update site: `repositories/com.codepilot1c.update/target/com.codepilot1c.update-0.1.7-SNAPSHOT.zip`.
